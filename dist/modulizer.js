// Â© 2025 City Pave. All Rights Reserved. Unauthorized copying is prohibited.
const fs = require('fs'); const path = require('path'); const MODULES = require('./modules.json'); const SHARED_FILES = ['navigation.js', 'style.css', 'config.js', 'qa-agent.js', 'theme-engine.js', 'storage-gatekeeper.js']; function processModule(moduleName, config) { console.log(`\nProcessing Module: ${moduleName}...`); const moduleDir = path.join(__dirname, 'modules', moduleName); if (!fs.existsSync(moduleDir)) { fs.mkdirSync(moduleDir, { recursive: true }); console.log(`  Created directory: ${moduleDir} `); } config.files.forEach(file => { const srcPath = path.join(__dirname, file); let destFilename = file; if (file === config.mainHtml) { destFilename = 'index.html'; } const destPath = path.join(moduleDir, destFilename); if (fs.existsSync(srcPath)) { let content = fs.readFileSync(srcPath, 'utf8'); content = updatePaths(content, file); fs.writeFileSync(destPath, content); fs.unlinkSync(srcPath); console.log(`  Moved & Updated: ${file} -> ${moduleName}/${destFilename}`); } else { console.warn(`  WARNING: File not found: ${file}`); } }); } function updatePaths(content, filename) { const isHtml = filename.endsWith('.html'); const isJs = filename.endsWith('.js'); if (isHtml) { content = content.replace(/href="style.css"/g, 'href="../../style.css"'); content = content.replace(/src="navigation.js"/g, 'src="../../navigation.js"'); content = content.replace(/src="qa-agent.js"/g, 'src="../../qa-agent.js"'); content = content.replace(/src="config.js"/g, 'src="../../config.js"'); } if (isJs || isHtml) { content = content.replace(/from ['"]\.\/config\.js['"]/g, "from '../../config.js'"); content = content.replace(/from ['"]\.\/navigation\.js['"]/g, "from '../../navigation.js'"); content = content.replace(/from ['"]\.\/theme-engine\.js['"]/g, "from '../../theme-engine.js'"); content = content.replace(/from ['"]\.\/storage-gatekeeper\.js['"]/g, "from '../../storage-gatekeeper.js'"); } return content; } Object.keys(MODULES).forEach(name => { if (name === 'admin') { MODULES.admin.files = MODULES.admin.files.filter(f => f !== 'qa-agent.js'); } processModule(name, MODULES[name]); }); console.log("\nDone! Please update navigation.js manually to point to the new locations.");