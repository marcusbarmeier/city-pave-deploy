// Â© 2025 City Pave. All Rights Reserved. Unauthorized copying is prohibited.
import { initializeApp } from "https: import { getAuth, signInAnonymously } from "https: import { getFirestore, doc, writeBatch } from "https: import { pricingOptions } from './pricing.js'; const firebaseConfig = { apiKey: "AIzaSyADrnYgh1fSTo3IZD7HOEJMyjduzDYIYSs", authDomain: "city-pave-estimator.firebaseapp.com", projectId: "city-pave-estimator", storageBucket: "city-pave-estimator.firebasestorage.app", messagingSenderId: "111714884839", appId: "1:111714884839:web:2b782a1b7be5be8edc5642" }; const app = initializeApp(firebaseConfig); const auth = getAuth(app); const db = getFirestore(app); const globalSettings = { id: 'global_settings', fuel: { isActive: true, baselinePrice: 1.50, currentPrice: 1.50, threshold: 0.05, surchargeRate: 1.0 }, taxRate: 0.05, updatedAt: new Date().toISOString() }; const engineVariables = [ { id: 'engine_snow_v1', name: 'Snow Clearing Engine', mode: 'engine', variables: { loader_rate: 160, skid_steer_rate: 110, shovel_crew_rate: 130, dump_truck_rate: 125, salting_truck_rate: 130, loader_performance_sqft: 45000, skid_performance_sqft: 12000, shovel_performance_sqft: 2000, truck_capacity_m3: 17.2, min_charge_hours: 4 } }, { id: 'engine_excavation_v1', name: 'Excavation Engine', mode: 'engine', variables: { excavator_efficiency: 0.85, standard_cycle_time_sec: 25, avg_haul_speed_kmh: 40, dump_wait_time_min: 10, truck_capacity_loose_yds: 18 } } ]; async function runMigration() { console.log("Starting Pricing Migration..."); try { await signInAnonymously(auth); const batch = writeBatch(db); const settingsRef = doc(db, 'pricing_library', globalSettings.id); batch.set(settingsRef, globalSettings); console.log("Prepared Global Settings..."); engineVariables.forEach(engine => { const ref = doc(db, 'pricing_library', engine.id); batch.set(ref, engine); }); console.log("Prepared Engines..."); pricingOptions.forEach(item => { if (item.id === 'none') return; const ref = doc(db, 'pricing_library', item.id); const isEquipment = item.name.toLowerCase().includes('equipment') || item.name.toLowerCase().includes('truck') || item.name.toLowerCase().includes('skid') || item.name.toLowerCase().includes('loader'); batch.set(ref, { ...item, consumesFuel: isEquipment, tenantId: 'citypave', mode: item.variants ? 'variant' : (item.calculation ? 'dynamic' : 'simple'), updatedAt: new Date().toISOString() }); }); console.log(`Prepared ${pricingOptions.length} Line Items...`); await batch.commit(); console.log("Migration Complete! Database seeded."); alert("Success! Your Pricing Library and Fuel Settings are now in Firestore."); } catch (error) { console.error("Migration Failed:", error); alert("Migration Failed: " + error.message); } } runMigration();