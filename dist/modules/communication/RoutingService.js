// Â© 2025 City Pave. All Rights Reserved. Unauthorized copying is prohibited.
export class RoutingService { constructor() { this.routingTable = [ { type: 'MATERIAL', keywords: /(material|concrete|asphalt|supply|order|gravel|sand)/i, contextRequired: null, primary: 'Dispatch', secondary: 'ProjectManager', action: 'create-supply-request' }, { type: 'MECHANICAL', keywords: /(broken|leak|tire|smoke|engine|start|battery|flat|brakes)/i, contextRequired: 'vehicleId', primary: 'FleetManager', secondary: 'Mechanic', action: 'create-repair-ticket' }, { type: 'SAFETY', keywords: /(unsafe|hazard|injury|accident|hurt|crash|fire|spill)/i, contextRequired: 'gps', primary: 'SafetyOfficer', secondary: 'Owner', action: 'trigger-red-phone' }, { type: 'ACCESS', keywords: /(gate|code|lock|access|key|entry)/i, contextRequired: 'siteId', primary: 'Foreman', secondary: 'Dispatch', action: 'ai-intercept-access' }, { type: 'GENERAL', keywords: /(address|time|schedule|weather|when|where)/i, contextRequired: null, primary: 'AI_INTERCEPT', secondary: 'Dispatch', action: 'ai-answer-question' } ]; } analyze(text, context) { const safetyRoute = this.routingTable.find(r => r.type === 'SAFETY'); if (safetyRoute.keywords.test(text)) { return { recipient: safetyRoute.primary, action: safetyRoute.action, confidence: 1.0, type: 'SAFETY' }; } for (const route of this.routingTable) { if (route.keywords.test(text)) { if (route.contextRequired && !context[route.contextRequired]) { console.warn(`[RoutingService] Missing context ${route.contextRequired} for ${route.type}`); return { recipient: 'Dispatch', action: 'clarify-request', confidence: 0.5, originalType: route.type }; } return { recipient: route.primary, action: route.action, confidence: 0.9, type: route.type }; } } return { recipient: 'GeneralChannel', action: 'broadcast-message', confidence: 0.1, type: 'UNKNOWN' }; } } export const routingService = new RoutingService();