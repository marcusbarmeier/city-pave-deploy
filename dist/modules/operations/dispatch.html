<!-- // ¬© 2025 City Pave. All Rights Reserved. Unauthorized copying is prohibited. -->
<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>City Pave - Dispatch Command Center</title><script src="https://cdn.tailwindcss.com"></script><link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"><script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js'></script><script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script><script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script><script src="https://unpkg.com/@babel/standalone/babel.min.js"></script><link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" /><script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script><style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }

        .fc-event {
            cursor: pointer;
            font-size: 0.85rem;
        }

        .fc-toolbar-title {
            font-size: 1.25rem !important;
            font-weight: 600;
        }

        .draggable-job {
            cursor: grab;
            transition: all 0.2s;
        }

        .draggable-job:active {
            cursor: grabbing;
            transform: scale(0.98);
        }

        #map {
            height: 100%;
            width: 100%;
            border-radius: 0.5rem;
        }
    </style></head><body class="h-screen flex flex-col overflow-hidden"><div id="app-navigation" class="fixed top-0 left-0 right-0 z-50"></div><script type="module" src="../../navigation.js"></script><div class="h-16 flex-shrink-0"></div><div class="flex flex-1 overflow-hidden"><aside class="w-80 bg-white border-r border-gray-200 flex flex-col z-10 shadow-lg"><div class="p-4 border-b border-gray-200 bg-gray-50"><h2 class="text-lg font-bold text-gray-900">Unscheduled Jobs</h2><p class="text-xs text-gray-500 mt-1">Drag to calendar to schedule</p><input type="text" id="job-search" placeholder="Search jobs..."
                    class="mt-2 w-full text-sm border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500"></div><div id="unscheduled-list" class="flex-1 overflow-y-auto p-4 space-y-3"><div class="text-center text-gray-400 text-sm py-10">Loading jobs...</div></div></aside><main class="flex-1 flex flex-col relative"><div class="h-12 bg-white border-b border-gray-200 flex items-center justify-between px-4"><div class="flex bg-slate-100 p-1 rounded-lg"><button id="view-calendar"
                        class="px-4 py-1.5 rounded-md text-sm font-medium text-blue-700 bg-blue-100 transition-all">Calendar</button><button id="view-gantt"
                        class="px-4 py-1.5 rounded-md text-sm font-medium text-gray-600 hover:bg-gray-200 transition-all">Gantt</button><button id="view-map"
                        class="px-4 py-1.5 rounded-md text-sm font-medium text-gray-600 hover:bg-gray-200 transition-all">Map</button></div><div class="flex items-center gap-2"><button id="manage-crews-btn"
                        class="px-3 py-1 text-sm font-medium rounded-md bg-gray-100 text-gray-700 hover:bg-gray-200 border border-gray-300">
                        Manage Crews
                    </button><div class="h-6 w-px bg-gray-300 mx-2"></div><span class="text-xs text-gray-500">Filter Crew:</span><select id="crew-filter" class="text-sm border-gray-300 rounded-md shadow-sm"><option value="all">All Crews</option><option value="A">Crew A (Paving)</option><option value="B">Crew B (Prep)</option><option value="C">Crew C (Seal)</option></select></div><div class="flex items-center gap-2 ml-4 border-l pl-4 border-gray-300"><button id="snow-mode-btn"
                        class="px-3 py-1 text-sm font-bold rounded-md bg-white text-blue-500 border border-blue-200 hover:bg-blue-50 transition-colors flex items-center gap-1">
                        ‚ùÑÔ∏è Snow Mode
                    </button><button id="storm-alert-btn"
                        class="hidden px-3 py-1 text-sm font-bold rounded-md bg-red-600 text-white hover:bg-red-700 shadow-sm animate-pulse">
                        üö® Storm Alert
                    </button></div></div><div id="calendar-container" class="flex-1 p-4 overflow-hidden bg-white"><div id="calendar" class="h-full"></div></div><div id="map-container"
                class="hidden bg-white rounded-xl shadow-sm border border-slate-200 flex-grow overflow-hidden relative"><div id="map" class="h-full w-full z-0"></div><div class="absolute top-4 right-4 z-[400] bg-white p-2 rounded shadow-md"><button id="optimize-route-btn"
                        class="bg-green-600 text-white text-xs font-bold px-3 py-2 rounded hover:bg-green-700 shadow flex items-center gap-2"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg>
                        Optimize Route
                    </button></div><div class="absolute top-6 right-6 w-80 bg-white rounded-lg shadow-xl p-4 max-h-[80%] overflow-y-auto"><h3 class="font-bold text-gray-900 mb-2">Daily Route</h3><ul id="route-list" class="space-y-2 text-sm"><li class="text-gray-500 italic">Select a day to view route.</li></ul></div></div></main><div id="job-details-panel"
            class="hidden absolute inset-y-0 right-0 w-96 bg-white shadow-2xl transform transition-transform duration-300 z-30 border-l border-gray-200 flex flex-col"><div class="p-4 border-b border-gray-200 flex justify-between items-center bg-gray-50"><h3 class="text-lg font-bold text-gray-900">Job Details</h3><button id="close-details-btn" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button></div><div class="flex-1 overflow-y-auto p-4" id="job-details-content"></div><div class="p-4 border-t border-gray-200 bg-gray-50"><button id="save-job-changes-btn"
                    class="w-full bg-blue-600 text-white py-2 rounded-md font-bold hover:bg-blue-700">Save
                    Changes</button></div></div></div><div id="crew-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"><div class="relative top-20 mx-auto p-5 border w-[800px] shadow-lg rounded-md bg-white"><div class="flex justify-between items-center mb-4"><h3 class="text-lg font-bold text-gray-900">Daily Crew Assignments</h3><button id="close-crew-modal" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button></div><div class="grid grid-cols-4 gap-4 h-96"><div class="col-span-1 bg-gray-50 p-3 rounded border flex flex-col"><h4 class="font-bold text-sm text-gray-700 mb-2">Available Staff</h4><div id="staff-pool" class="flex-1 overflow-y-auto space-y-2 min-h-0"></div></div><div class="col-span-1 bg-red-50 p-3 rounded border border-red-100 flex flex-col"><h4 class="font-bold text-sm text-red-800 mb-2">Crew A (Paving)</h4><div id="crew-a-list" class="flex-1 overflow-y-auto space-y-2 min-h-0" data-crew="A"></div></div><div class="col-span-1 bg-green-50 p-3 rounded border border-green-100 flex flex-col"><h4 class="font-bold text-sm text-green-800 mb-2">Crew B (Prep)</h4><div id="crew-b-list" class="flex-1 overflow-y-auto space-y-2 min-h-0" data-crew="B"></div></div><div class="col-span-1 bg-blue-50 p-3 rounded border border-blue-100 flex flex-col"><h4 class="font-bold text-sm text-blue-800 mb-2">Crew C (Seal)</h4><div id="crew-c-list" class="flex-1 overflow-y-auto space-y-2 min-h-0" data-crew="C"></div></div></div><div class="mt-4 flex justify-end"><button id="save-crews-btn"
                    class="bg-blue-600 text-white px-4 py-2 rounded font-bold hover:bg-blue-700">
                    Save Assignments
                </button></div></div></div><script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";
        import { getFirestore, collection, query, where, getDocs, updateDoc, doc, onSnapshot, addDoc } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";

        import { initializeDispatchApp } from './dispatch.js';
        import { config } from '../../config.js';

        const app = initializeApp(config.firebase);
        const auth = getAuth(app);
        const db = getFirestore(app);

        window.firebaseServices = { auth, db, collection, query, where, getDocs, updateDoc, doc, onSnapshot, addDoc, onAuthStateChanged };

        // Initialize
        // Initialize
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeDispatchApp);
        } else {
            initializeDispatchApp();
        }
    </script><script type="module" src="../../qa-agent.js"></script></body></html>