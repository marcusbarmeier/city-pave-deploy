// Â© 2025 City Pave. All Rights Reserved. Unauthorized copying is prohibited.
export const WeatherService = { cache: {}, async getForecast(lat, lng) { const cacheKey = `${lat.toFixed(2)},${lng.toFixed(2)}`; const now = Date.now(); if (this.cache[cacheKey] && (now - this.cache[cacheKey].timestamp < 3600000)) { return this.cache[cacheKey].data; } try { const response = await fetch(`https: const data = await response.json(); this.cache[cacheKey] = { timestamp: now, data: data }; return data; } catch (error) { console.error("WeatherService Error:", error); return null; } }, isRainy(dateStr, forecastData) { if (!forecastData || !forecastData.daily) return false; const index = forecastData.daily.time.indexOf(dateStr); if (index === -1) return false; const precipProb = forecastData.daily.precipitation_probability_max[index]; const precipSum = forecastData.daily.precipitation_sum[index]; const code = forecastData.daily.weathercode[index]; const rainyCodes = [51, 53, 55, 61, 63, 65, 66, 67, 80, 81, 82, 95, 96, 99]; const isRainyCode = rainyCodes.includes(code); const highProb = precipProb > 50; const significantRain = precipSum > 1.0; return isRainyCode || highProb || significantRain; }, getWeatherIcon(code) { if (code === 0) return 'â˜€ï¸'; if (code >= 1 && code <= 3) return 'Vk'; if (code >= 45 && code <= 48) return 'ðŸŒ«ï¸'; if (code >= 51 && code <= 67) return 'ðŸŒ§ï¸'; if (code >= 71 && code <= 77) return 'â„ï¸'; if (code >= 80 && code <= 82) return 'ðŸŒ¦ï¸'; if (code >= 95 && code <= 99) return 'â›ˆï¸'; return 'â“'; } };