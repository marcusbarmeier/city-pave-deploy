// © 2025 City Pave. All Rights Reserved. Unauthorized copying is prohibited.
export class PlanEditor { constructor(containerId) { this.containerId = containerId; this.plan = null; this.onSave = async (id, data) => { }; } open(plan) { this.plan = plan; this.render(); const modal = document.getElementById('edit-plan-modal'); modal.showModal(); } render() { const container = document.getElementById(this.containerId); const html = ` <dialog id="edit-plan-modal" class="bg-gray-800 text-white rounded-xl shadow-2xl backdrop:bg-black/80 border border-gray-600 p-0 w-full max-w-2xl"> <div class="p-6"> <h3 class="text-xl font-bold mb-4 flex items-center gap-2"> <span>✏️</span> Edit Plan: <span class="text-blue-400">${this.plan.internal_tier_id}</span> </h3> <form method="dialog" id="edit-plan-form" class="space-y-4"> <div class="grid grid-cols-2 gap-4"> <div> <label class="block text-xs uppercase text-gray-500 font-bold mb-1">Display Name</label> <input type="text" id="edit-display-name" value="${this.plan.display_name || ''}" required class="w-full bg-gray-900 border border-gray-600 rounded px-3 py-2 text-white focus:border-blue-500 outline-none" /> </div> <div> <label class="block text-xs uppercase text-gray-500 font-bold mb-1">Price Label Override</label> <input type="text" id="edit-price-label" value="${this.plan.price_label_override || ''}" required placeholder="e.g. $99/mo" class="w-full bg-gray-900 border border-gray-600 rounded px-3 py-2 text-white focus:border-blue-500 outline-none" /> </div> </div> <div> <label class="block text-xs uppercase text-gray-500 font-bold mb-1">Marketing Tagline (The "Pitch")</label> <input type="text" id="edit-tagline" value="${this.plan.marketing_tagline || ''}" required class="w-full bg-gray-900 border border-gray-600 rounded px-3 py-2 text-white focus:border-blue-500 outline-none" /> </div> <!-- Store Mapping --> <div class="bg-gray-900/50 p-3 rounded border border-gray-700"> <h4 class="text-xs uppercase text-green-400 font-bold mb-2">Store Product IDs (The "Rosetta Stone")</h4> <div class="grid grid-cols-3 gap-3"> <div> <label class="block text-[10px] text-gray-500 uppercase mb-1">iOS Product ID</label> <input type="text" id="edit-pid-ios" value="${this.plan.store_product_ids?.ios || ''}" class="w-full bg-gray-800 border border-gray-600 rounded px-2 py-1 text-white text-xs outline-none" /> </div> <div> <label class="block text-[10px] text-gray-500 uppercase mb-1">Android Product ID</label> <input type="text" id="edit-pid-android" value="${this.plan.store_product_ids?.android || ''}" class="w-full bg-gray-800 border border-gray-600 rounded px-2 py-1 text-white text-xs outline-none" /> </div> <div> <label class="block text-[10px] text-gray-500 uppercase mb-1">Stripe Price ID</label> <input type="text" id="edit-pid-stripe" value="${this.plan.store_product_ids?.stripe || ''}" class="w-full bg-gray-800 border border-gray-600 rounded px-2 py-1 text-white text-xs outline-none" /> </div> </div> </div> <!-- Config Controls --> <div class="grid grid-cols-1 gap-4 bg-gray-900/50 p-3 rounded border border-gray-700"> <div> <label class="block text-xs uppercase text-blue-400 font-bold mb-1">Module Permissions (Array, CSV)</label> <input type="text" id="edit-modules" value="${(this.plan.module_permissions || []).join(', ')}" class="w-full bg-gray-800 border border-gray-600 rounded px-2 py-1 text-white text-xs outline-none" /> <p class="text-[10px] text-gray-500 mt-1">Modules: estimating, invoicing, dispatch, snow_removal...</p> </div> </div> <div> <label class="block text-xs uppercase text-gray-500 font-bold mb-1">Feature Bullets (1 per line)</label> <textarea id="edit-bullets" rows="4" class="w-full bg-gray-900 border border-gray-600 rounded px-3 py-2 text-white focus:border-blue-500 outline-none">${(this.plan.feature_bullets || []).join('\n')}</textarea> </div> <div class="flex justify-end gap-3 pt-4 border-t border-gray-700 mt-4"> <button type="button" onclick="document.getElementById('edit-plan-modal').close()" class="px-4 py-2 text-gray-400 hover:text-white text-sm font-bold">Cancel</button> <button id="save-plan-btn" class="bg-blue-600 hover:bg-blue-500 text-white px-6 py-2 rounded text-sm font-bold shadow-lg">Save Changes</button> </div> </form> </div> </dialog> `; const oldModal = document.getElementById('edit-plan-modal'); if (oldModal) oldModal.remove(); const template = document.createElement('div'); template.innerHTML = html; container.appendChild(template.firstElementChild); document.getElementById('save-plan-btn').addEventListener('click', (e) => { e.preventDefault(); this.handleSave(); }); } handleSave() { const updates = { display_name: document.getElementById('edit-display-name').value, marketing_tagline: document.getElementById('edit-tagline').value, price_label_override: document.getElementById('edit-price-label').value, feature_bullets: document.getElementById('edit-bullets').value.split('\n').map(s => s.trim()).filter(s => s), store_product_ids: { ios: document.getElementById('edit-pid-ios').value, android: document.getElementById('edit-pid-android').value, stripe: document.getElementById('edit-pid-stripe').value }, module_permissions: document.getElementById('edit-modules').value.split(',').map(s => s.trim()).filter(s => s) }; this.onSave(this.plan.internal_tier_id, updates); document.getElementById('edit-plan-modal').close(); } }