// Â© 2025 City Pave. All Rights Reserved. Unauthorized copying is prohibited.
export function calculateExcavationMetrics(inputs) { const { areaSqFt, depthFt, swellFactor, truckCapacityLooseYd, bucketSizeYd, excCycleSec, efficiencyPercent, haulDistKm, haulSpeedKmh, dumpWaitMin } = inputs; const bankVolCuFt = areaSqFt * depthFt; const bankVolCuYd = bankVolCuFt / 27; const looseVolCuYd = bankVolCuYd * swellFactor; const safeTruckCap = truckCapacityLooseYd > 0 ? truckCapacityLooseYd : 1; const totalLoads = Math.ceil(looseVolCuYd / safeTruckCap); const efficiencyDecimal = (efficiencyPercent || 85) / 100; const bucketsPerTruck = Math.ceil(safeTruckCap / (bucketSizeYd || 1)); const loadTimeMin = (bucketsPerTruck * (excCycleSec || 25)) / 60 / efficiencyDecimal; const safeSpeed = haulSpeedKmh > 0 ? haulSpeedKmh : 1; const travelTimeMin = (haulDistKm / safeSpeed) * 60 * 2; const truckCycleMin = loadTimeMin + travelTimeMin + dumpWaitMin; const trucksNeeded = loadTimeMin > 0 ? truckCycleMin / loadTimeMin : 0; const maxLoadsPerHour = loadTimeMin > 0 ? 60 / loadTimeMin : 0; const totalHours = maxLoadsPerHour > 0 ? totalLoads / maxLoadsPerHour : 0; const warnings = []; if (swellFactor === 1.3 && excCycleSec < 40) { warnings.push({ type: 'warning', msg: `${excCycleSec}s is too optimistic for heavy clay. Recommend >40s.` }); } else if (swellFactor === 1.5 && excCycleSec < 45) { warnings.push({ type: 'error', msg: `Rock excavation typically requires >45s cycle times.` }); } return { volumes: { bankCuYd: bankVolCuYd, looseCuYd: looseVolCuYd }, loads: totalLoads, cycles: { loadTimeMin, travelTimeMin, truckCycleMin }, optimization: { trucksNeeded, bucketsPerTruck }, durationHours: totalHours, warnings }; }