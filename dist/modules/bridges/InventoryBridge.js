// Â© 2025 City Pave. All Rights Reserved. Unauthorized copying is prohibited.
import { BaseBridge } from './BaseBridge.js'; export class InventoryBridge extends BaseBridge { constructor() { super('InvoiceScanner', 'Inventory'); } extract(context) { console.log("[InventoryBridge] Extracting from Invoice Scan...", context.invoice.items.length, "items found."); return context.invoice.items; } transform(rawItems) { const processed = rawItems.map(item => { let category = 'Uncategorized'; const lowerName = item.name.toLowerCase(); if (lowerName.includes('oil') || lowerName.includes('filter') || lowerName.includes('brake')) category = 'Maintenance Parts'; else if (lowerName.includes('asphalt') || lowerName.includes('gravel') || lowerName.includes('sand')) category = 'Raw Materials'; else if (lowerName.includes('glove') || lowerName.includes('vest') || lowerName.includes('helmet')) category = 'Safety Gear'; else if (lowerName.includes('paper') || lowerName.includes('pen')) category = 'Office Supplies'; return { sku: `GEN-${Math.floor(Math.random() * 10000)}`, name: item.name, category: category, quantity: item.qty, cost: item.unitPrice, status: 'In Stock', lastUpdated: new Date().toISOString() }; }); return { items: processed, count: processed.length }; } async load(processedData, dbRef) { console.log(`[InventoryBridge] Loading ${processedData.count} items into Inventory...`); if (typeof window !== 'undefined' && window.firebaseServices) { const { addDoc, collection } = window.firebaseServices; for (const item of processedData.items) { await addDoc(collection(dbRef, 'inventory'), item); } } else { console.log("[InventoryBridge] Mock DB Insert:", processedData.items); } return { success: true, itemsAdded: processedData.count }; } }