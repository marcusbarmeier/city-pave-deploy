// ¬© 2025 City Pave. All Rights Reserved. Unauthorized copying is prohibited.
import { renderInvoiceScanner } from '/modules/finance/invoice-scanner/invoice-scanner.js'; export class NavigationUI { constructor(containerId) { this.container = document.getElementById(containerId); if (!this.container) { console.error(`Nav container ${containerId} not found`); return; } this.activeAlert = null; this.dashcamActive = false; } renderBaseUI() { this.container.innerHTML = ` <div id="nav-viewport" class="relative w-full h-full bg-gray-900 overflow-hidden flex flex-col"> <!-- 1. MAP AREA (Flexible Height) --> <div id="nav-map-container" class="relative w-full h-full transition-[height] duration-300 ease-in-out"> <!-- Map is injected here by NavApp --> <div id="nav-map-overlay-ui" class="absolute inset-x-0 top-0 p-2 z-10 pointer-events-none"> <!-- Top Header (Menu, Exit) --> <div class="pointer-events-auto bg-gray-900/90 backdrop-blur-md text-white p-2 rounded-xl shadow-lg flex items-center justify-between border border-gray-700"> <div class="flex items-center gap-2"> <button id="nav-menu-btn" class="p-2 rounded-lg hover:bg-gray-800 text-gray-300 hover:text-white transition-colors"> <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg> </button> <button id="nav-exit-btn" class="p-2 rounded-lg hover:bg-red-600 text-gray-300 hover:text-white transition-colors"> <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg> </button> </div> <div class="flex flex-col items-center"> <h2 id="nav-job-title" class="text-sm font-bold text-white max-w-[150px] truncate">No Active Job</h2> </div> <!-- Dashcam REMOVED --> </div> </div> </div> <!-- 2. FLIGHT STRIP (HUD) --> <div id="nav-flight-strip" class="bg-gray-900 text-white p-2 flex items-center justify-between border-t border-gray-800 z-20 shadow-xl"> <!-- Speed --> <div class="flex flex-col items-center w-1/4 border-r border-gray-700"> <span id="nav-speed" class="text-3xl font-black text-white leading-none">0</span> <span class="text-[10px] text-gray-400 font-bold">MPH</span> </div> <!-- Instruction --> <div class="flex-1 px-4 flex flex-col justify-center overflow-hidden"> <div id="nav-next-instruction" class="text-sm font-medium text-white truncate">Preparing Route...</div> <div class="flex items-base gap-2"> <div id="nav-distance" class="text-xs text-blue-400 font-bold">-- mi</div> <div id="nav-eta" class="text-xs text-gray-400 font-bold">--:--</div> </div> </div> <!-- Actions --> <div class="flex items-center gap-2 w-1/4 justify-end"> <button id="nav-load-btn" class="p-2 bg-blue-600 rounded-lg text-white font-bold text-xs shadow hover:bg-blue-500 whitespace-nowrap"> Load Wizard </button> </div> </div> </div> <!-- Alert Area --> <div id="nav-alert-area" class="absolute inset-0 z-[60] pointer-events-none flex items-center justify-center p-4"></div> `; } show(mode = true) { const hud = document.getElementById('nav-viewport'); if (hud) { if (mode) hud.classList.remove('hidden'); else hud.classList.add('hidden'); } } updateInstruction(text, distance) { const panel = document.getElementById('nav-directions-panel'); if (panel) panel.classList.remove('hidden'); const tEl = document.getElementById('nav-next-instruction'); const dEl = document.getElementById('nav-distance'); if (tEl) tEl.innerHTML = text; if (dEl) dEl.innerText = distance; } updateJobTitle(title) { const el = document.getElementById('nav-job-title'); if (el) el.textContent = title; } updateZone(name, type) { const zEl = document.getElementById('nav-zone-name'); if (zEl) zEl.textContent = name || "In Transit"; } updateSpeed(speedMph) { const sEl = document.getElementById('nav-speed'); if (sEl) sEl.innerHTML = `${Math.round(speedMph)}`; } showPrompt(title, message, actions) { this.show(true); const area = document.getElementById('nav-alert-area'); if (!area) return; area.innerHTML = ''; area.style.pointerEvents = 'auto'; area.innerHTML = ` <div class="bg-white rounded-2xl shadow-2xl p-6 w-full max-w-sm border-t-8 border-indigo-600 animate-[bounceIn_0.3s_ease-out] relative"> <button id="prompt-close-x" class="absolute top-2 right-2 text-gray-400 hover:text-gray-600 p-2"> <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg> </button> <h3 class="text-xl font-bold text-gray-900 mb-2 pr-6">${title}</h3> <p class="text-gray-600 mb-6 text-base leading-relaxed">${message}</p> <div class="space-y-3"> ${actions.map((act, idx) => ` <button class="nav-act-btn w-full py-4 rounded-xl font-bold text-white text-lg transition-transform active:scale-95 ${act.style || 'bg-indigo-600 hover:bg-indigo-700'}" data-idx="${idx}"> ${act.label} </button> `).join('')} </div> </div> `; const closeBtn = area.querySelector('#prompt-close-x'); if (closeBtn) { closeBtn.addEventListener('click', () => { area.innerHTML = ''; area.style.pointerEvents = 'none'; }); } area.querySelectorAll('.nav-act-btn').forEach(btn => { btn.addEventListener('click', (e) => { const idx = e.target.getAttribute('data-idx'); if (actions[idx].onClick) actions[idx].onClick(); area.innerHTML = ''; area.style.pointerEvents = 'none'; }); }); } renderJobDetailsModal(dispatchData, onClose) { const area = document.getElementById('nav-alert-area'); if (!area) return; area.innerHTML = ''; area.style.pointerEvents = 'auto'; dispatchData = dispatchData || {}; area.innerHTML = ` <div class="bg-white rounded-2xl shadow-2xl overflow-hidden w-full max-w-sm animate-[fadeIn_0.2s_ease-out] border border-gray-200"> <div class="bg-gray-100 p-4 border-b border-gray-200 flex justify-between items-center"> <h3 class="font-bold text-gray-800 text-lg">Job Details</h3> <button id="modal-close-btn" class="p-2 bg-gray-200 rounded-full hover:bg-gray-300"> <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg> </button> </div> <div class="p-6 space-y-4"> <div> <label class="text-xs font-bold text-gray-500 uppercase">Client</label> <p class="text-lg font-semibold text-gray-900">${dispatchData.clientName || 'N/A'}</p> </div> <div> <label class="text-xs font-bold text-gray-500 uppercase">Site Address</label> <p class="text-gray-700">${dispatchData.siteAddress || 'N/A'}</p> </div> <div> <label class="text-xs font-bold text-gray-500 uppercase">Description</label> <p class="text-sm text-gray-600">${dispatchData.description || 'No notes provided.'}</p> </div> <div class="pt-4 border-t border-gray-100 grid grid-cols-2 gap-3"> <button class="py-3 bg-indigo-50 text-indigo-700 font-bold rounded-lg hover:bg-indigo-100" onclick="${dispatchData.foremanPhone ? `window.location.href='tel:${dispatchData.foremanPhone}'` : `alert('No Foreman number on file. Please contact your Supervisor directly.')`}"> üìû ${dispatchData.foremanPhone ? 'Call Foreman' : 'Contact Super'} </button> <a href="work-order.html?id=${dispatchData.id}" target="_blank" class="flex items-center justify-center py-3 bg-gray-50 text-gray-700 font-bold rounded-lg hover:bg-gray-100 border border-gray-200"> üìÑ Job Details </a> </div> </div> </div> `; document.getElementById('modal-close-btn').addEventListener('click', () => { area.innerHTML = ''; area.style.pointerEvents = 'none'; if (onClose) onClose(); }); } renderMenu(currentOptions, onSave, onAddStop, onLogLoad) { const area = document.getElementById('nav-alert-area'); if (!area) return; area.style.pointerEvents = 'auto'; area.innerHTML = ` <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-sm border border-gray-200 animate-[fadeIn_0.2s_ease-out] relative"> <!-- Close X --> <button id="menu-close-x" class="absolute top-2 right-2 p-2 bg-gray-100 rounded-full text-gray-400 hover:text-gray-600"> <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg> </button> <h3 class="text-xl font-bold text-gray-900 mb-4">Route Controls</h3> <!-- Action Buttons --> <div class="mb-6 grid grid-cols-2 gap-2"> <button id="btn-add-stop" class="p-2 bg-indigo-50 text-indigo-700 text-xs font-bold rounded-xl hover:bg-indigo-100 flex flex-col items-center gap-1"> <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg> Add Stop </button> <!-- Log Load Button Removed --> <button id="btn-re-optimize" class="p-2 bg-green-50 text-green-700 text-xs font-bold rounded-xl hover:bg-green-100 flex flex-col items-center gap-1"> <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg> Efficient </button> </div> <div class="space-y-3 mb-6"> <label class="flex items-center justify-between p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 border border-gray-100"> <span class="font-medium text-gray-700 text-sm">üöö Avoid Highways</span> <input type="checkbox" id="opt-highways" ${currentOptions.avoidHighways ? 'checked' : ''} class="w-5 h-5 text-indigo-600 rounded"> </label> <label class="flex items-center justify-between p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 border border-gray-100"> <span class="font-medium text-gray-700 text-sm">üõë Avoid Tolls</span> <input type="checkbox" id="opt-tolls" ${currentOptions.avoidTolls ? 'checked' : ''} class="w-5 h-5 text-indigo-600 rounded"> </label> <label class="flex items-center justify-between p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 border border-gray-100"> <div class="flex flex-col"> <span class="font-medium text-gray-700 text-sm">‚öñÔ∏è Avoid Truck Scales</span> </div> <input type="checkbox" id="opt-scales" ${currentOptions.avoidScales ? 'checked' : ''} class="w-5 h-5 text-indigo-600 rounded"> </label> <label class="flex items-center justify-between p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 border border-gray-100"> <div class="flex flex-col"> <span class="font-medium text-gray-700 text-sm">üö´ Avoid Load Restricted</span> </div> <input type="checkbox" id="opt-restricted" ${currentOptions.avoidRestricted ? 'checked' : ''} class="w-5 h-5 text-indigo-600 rounded"> </label> </div > <div class="flex gap-3"> <button id="btn-cancel-opts" class="flex-1 py-3 font-bold text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200">Close</button> <button id="btn-save-opts" class="flex-1 py-3 font-bold text-white bg-indigo-600 rounded-lg hover:bg-indigo-700 shadow-lg shadow-indigo-200">Update Route</button> </div> </div > `; const closeMenu = () => { area.innerHTML = ''; area.style.pointerEvents = 'none'; }; document.getElementById('btn-cancel-opts').addEventListener('click', closeMenu); document.getElementById('menu-close-x').addEventListener('click', closeMenu); document.getElementById('btn-save-opts').addEventListener('click', () => { const newOpts = { avoidHighways: document.getElementById('opt-highways').checked, avoidTolls: document.getElementById('opt-tolls').checked, avoidScales: document.getElementById('opt-scales').checked, avoidRestricted: document.getElementById('opt-restricted').checked }; onSave(newOpts); closeMenu(); }); document.getElementById('btn-add-stop').addEventListener('click', () => { closeMenu(); if (onAddStop) onAddStop(); }); const logLoadBtn = document.getElementById('btn-log-load'); if (logLoadBtn) { logLoadBtn.addEventListener('click', () => { closeMenu(); if (onLogLoad) onLogLoad(); }); } } renderSmartDashboard(data, onAction) { const area = document.getElementById('nav-alert-area'); if (!area) return; area.style.pointerEvents = 'auto'; area.innerHTML = ''; const renderJobCard = (job, type) => { const colorClass = type === 'priority' ? 'border-amber-500 bg-amber-50' : type === 'open' ? 'border-green-500 bg-green-50' : 'border-gray-200 bg-white'; const btnText = type === 'priority' ? '‚ñ∂ Start' : type === 'open' ? '‚úã Claim' : 'Go'; return ` <div class="flex items-center justify-between p-3 mb-2 rounded-lg border-l-4 shadow-sm ${colorClass}"> <div class="overflow-hidden mr-2"> <h4 class="font-bold text-gray-800 truncate">${job.clientName}</h4> <p class="text-xs text-gray-500 truncate">${job.siteAddress || 'No Address'}</p> ${type === 'open' ? '<span class="text-[10px] font-bold text-green-700 bg-green-200 px-1 rounded">OPEN</span>' : ''} </div> <button class="dash-job-btn px-4 py-2 bg-gray-900 text-white text-xs font-bold rounded-lg hover:bg-gray-700 transition-colors" data-id="${job.id || job.clientName}" data-type="${type}"> ${btnText} </button> </div> `; }; let resumeHTML = ''; if (data.session) { resumeHTML = ` <div class="mb-4"> <h5 class="text-xs font-bold text-indigo-600 uppercase mb-2">Resuming Session</h5> <div class="p-4 bg-indigo-600 rounded-xl text-white shadow-lg flex justify-between items-center"> <div> <h3 class="font-bold truncate max-w-[150px]">${data.session.clientName}</h3> <p class="text-xs text-indigo-200">Started: ${new Date(data.session.startTime).toLocaleTimeString()}</p> </div> <button id="dash-btn-resume" class="px-4 py-2 bg-white text-indigo-600 font-bold rounded-lg hover:bg-indigo-50"> Resume </button> </div> </div> `; } const myJobsHTML = data.myAssignments && data.myAssignments.length > 0 ? data.myAssignments.map(j => renderJobCard(j, 'priority')).join('') : `<p class="text-sm text-gray-400 italic p-2">No assigned jobs today.</p>`; const openJobsHTML = data.openDispatches && data.openDispatches.length > 0 ? data.openDispatches.map(j => renderJobCard(j, 'open')).join('') : `<p class="text-sm text-gray-400 italic p-2">No open dispatches available.</p>`; area.innerHTML = ` <div class="bg-white rounded-2xl shadow-2xl overflow-hidden w-full max-w-md h-[80vh] flex flex-col animate-[fadeIn_0.3s_ease-out] border border-gray-200"> <!--Heavy Header--> <div class="bg-slate-900 p-6 flex-shrink-0"> <div class="flex justify-between items-start"> <div> <h2 class="text-2xl font-black text-white uppercase tracking-wide">Command Center</h2> <p class="text-slate-400 text-sm mt-1">Select your objective.</p> </div> <div class="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center"> <svg class="w-6 h-6 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg> </div> </div> </div> <!--Scrollable Content--> <div class="flex-grow overflow-y-auto p-6 space-y-6"> ${resumeHTML} <!-- 1. Priority Assignments --> <div> <div class="flex items-center gap-2 mb-2"> <div class="w-2 h-2 rounded-full bg-amber-500"></div> <h4 class="text-sm font-bold text-gray-500 uppercase">My Assignments</h4> </div> ${myJobsHTML} </div> <!-- 2. Open Board --> <div> <div class="flex items-center gap-2 mb-2"> <div class="w-2 h-2 rounded-full bg-green-500"></div> <h4 class="text-sm font-bold text-gray-500 uppercase">Open Board (Claim)</h4> </div> ${openJobsHTML} </div> <!-- 3. Actions --> <div> <h4 class="text-sm font-bold text-gray-500 uppercase mb-2">Actions</h4> <div class="grid grid-cols-2 gap-3"> <button id="dash-btn-projects" class="p-3 bg-gray-50 border border-gray-200 rounded-xl hover:bg-gray-100 flex flex-col items-center"> <span class="text-2xl mb-1">üèóÔ∏è</span> <span class="text-xs font-bold text-gray-700">Active Projects</span> </button> <button id="dash-btn-manual" class="p-3 bg-gray-50 border border-gray-200 rounded-xl hover:bg-gray-100 flex flex-col items-center"> <span class="text-2xl mb-1">üó∫Ô∏è</span> <span class="text-xs font-bold text-gray-700">Verbal / Custom</span> </button> </div> </div> </div> </div> `; if (data.session) { document.getElementById('dash-btn-resume').addEventListener('click', () => { if (onAction) onAction('resume', data.session); }); } area.querySelectorAll('.dash-job-btn').forEach(btn => { btn.addEventListener('click', (e) => { const id = e.target.getAttribute('data-id'); const type = e.target.getAttribute('data-type'); const list = type === 'priority' ? data.myAssignments : data.openDispatches; const job = list.find(j => (j.id || j.clientName) == id); if (job && onAction) onAction(type, job); }); }); document.getElementById('dash-btn-manual').addEventListener('click', () => { if (onAction) onAction('manual'); }); document.getElementById('dash-btn-projects').addEventListener('click', () => { alert("Project Browser Coming Soon"); }); } renderManualSearchModal(onSearch, onClose) { const area = document.getElementById('nav-alert-area'); if (!area) return; area.style.pointerEvents = 'auto'; area.innerHTML = ` <div class="bg-white rounded-2xl shadow-2xl overflow-hidden w-full max-w-sm animate-[fadeIn_0.2s_ease-out] border border-gray-200 relative" > <button id="search-close-x" class="absolute top-3 right-3 p-2 bg-gray-100 rounded-full text-gray-400 hover:text-gray-600"> <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg> </button> <div class="p-6"> <h3 class="text-xl font-bold text-gray-900 mb-1">Free Drive</h3> <p class="text-sm text-gray-500 mb-4">Enter a destination to start routing.</p> <input type="text" id="manual-search-input" class="w-full p-4 border border-gray-300 rounded-xl text-lg mb-4 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none" placeholder="123 Main St, City..."> <button id="btn-search-go" class="w-full py-4 bg-indigo-600 text-white font-bold rounded-xl hover:bg-indigo-700 shadow-lg shadow-indigo-200"> Start Navigation </button> </div> </div > `; const input = document.getElementById('manual-search-input'); input.focus(); const doSearch = () => { const val = input.value.trim(); if (val && onSearch) { onSearch(val); area.innerHTML = ''; area.style.pointerEvents = 'none'; } }; document.getElementById('btn-search-go').addEventListener('click', doSearch); input.addEventListener('keypress', (e) => { if (e.key === 'Enter') doSearch(); }); document.getElementById('search-close-x').addEventListener('click', () => { area.innerHTML = ''; area.style.pointerEvents = 'none'; if (onClose) onClose(); }); } renderStandbyModal(onConfirm) { this.show(true); const area = document.getElementById('nav-alert-area'); if (!area) return; area.innerHTML = ''; area.style.pointerEvents = 'auto'; area.innerHTML = ` <div class="bg-white rounded-2xl shadow-2xl p-6 w-full max-w-sm border-t-8 border-yellow-500 animate-[fadeIn_0.2s_ease-out] relative" > <button id="standby-close-x" class="absolute top-2 right-2 text-gray-400 hover:text-gray-600 p-2"> <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg> </button> <h3 class="text-xl font-bold text-gray-900 mb-4">Report Standby</h3> <div class="space-y-4"> <div> <label class="block text-sm font-bold text-gray-700 mb-1">Reason</label> <select id="standby-reason" class="w-full p-3 border rounded-lg bg-gray-50 text-lg"> <option value="Waiting for Load">Waiting for Load</option> <option value="Equipment Check">Equipment Check</option> <option value="Site Access Delay">Site Access Delay</option> <option value="Safety Hold">Safety Hold</option> <option value="Other">Other</option> </select> </div> <div> <label class="block text-sm font-bold text-gray-700 mb-1">Est. Duration</label> <div class="grid grid-cols-4 gap-2"> <button class="dur-btn p-2 border rounded bg-white hover:bg-yellow-50 font-bold text-sm" data-val="15">15m</button> <button class="dur-btn p-2 border rounded bg-white hover:bg-yellow-50 font-bold text-sm" data-val="30">30m</button> <button class="dur-btn p-2 border rounded bg-white hover:bg-yellow-50 font-bold text-sm" data-val="60">1h</button> <button class="dur-btn p-2 border rounded bg-white hover:bg-yellow-50 font-bold text-sm" data-val="120">2h</button> </div> <input type="hidden" id="standby-duration" value="30"> </div> <button id="confirm-standby" class="w-full py-3 bg-yellow-500 hover:bg-yellow-600 text-white font-bold rounded-xl shadow-lg mt-2"> Start Standby Timer </button> </div> </div > `; const durInput = document.getElementById('standby-duration'); area.querySelectorAll('.dur-btn').forEach(btn => { btn.addEventListener('click', (e) => { area.querySelectorAll('.dur-btn').forEach(b => b.classList.remove('bg-yellow-500', 'text-white')); e.target.classList.add('bg-yellow-500', 'text-white'); durInput.value = e.target.getAttribute('data-val'); }); }); area.querySelector('.dur-btn[data-val="30"]').click(); document.getElementById('confirm-standby').addEventListener('click', () => { const reason = document.getElementById('standby-reason').value; const duration = parseInt(durInput.value); onConfirm(reason, duration); area.innerHTML = ''; area.style.pointerEvents = 'none'; }); document.getElementById('standby-close-x').addEventListener('click', () => { area.innerHTML = ''; area.style.pointerEvents = 'none'; }); } renderLoadWizard(onComplete) { this.show(true); const area = document.getElementById('nav-alert-area'); if (!area) return; area.innerHTML = ''; area.style.pointerEvents = 'auto'; let loadData = { hasTicket: false, ticketText: '', ticketImage: null, material: '', isClean: false, notOverloaded: false, safetyConcerns: '', hasDamage: false, damageDescription: '', operatorName: '', operatorSignature: false }; const renderStep0_Type = () => { area.innerHTML = ` <div class="bg-white rounded-2xl shadow-xl w-full max-w-md overflow-hidden animate-[fadeIn_0.2s_ease-out]" > <div class="bg-gray-900 p-4 text-white flex justify-between items-center"> <h3 class="font-bold text-lg">Log Logic - Step 1/5</h3> <button id="wiz-close" class="text-white hover:text-gray-200"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button> </div> <div class="p-6 text-center space-y-6"> <p class="text-xl font-bold text-gray-800">What are you doing?</p> <div class="grid grid-cols-2 gap-4"> <button id="btn-type-load" class="py-8 rounded-xl border-2 border-indigo-100 bg-indigo-50 hover:bg-indigo-100 flex flex-col items-center justify-center gap-2 group transition-all"> <span class="text-4xl group-hover:scale-110 transition-transform">üöú</span> <span class="font-bold text-indigo-800">Getting Loaded</span> </button> <button id="btn-type-dump" class="py-8 rounded-xl border-2 border-amber-100 bg-amber-50 hover:bg-amber-100 flex flex-col items-center justify-center gap-2 group transition-all"> <span class="text-4xl group-hover:scale-110 transition-transform">üöÆ</span> <span class="font-bold text-amber-800">Dumping</span> </button> </div> </div> </div > `; document.getElementById('wiz-close').onclick = () => { area.innerHTML = ''; area.style.pointerEvents = 'none'; }; document.getElementById('btn-type-load').onclick = renderStep1_Ticket; document.getElementById('btn-type-dump').onclick = renderStep0B_DumpScan; }; const renderStep0B_DumpScan = () => { area.innerHTML = ` <div class="bg-white rounded-2xl shadow-xl w-full max-w-md overflow-hidden animate-[fadeIn_0.2s_ease-out]" > <div class="bg-amber-600 p-4 text-white"><h3 class="font-bold text-lg">Scan Dump Receipt</h3></div> <div id="scanner-container" class="p-4 min-h-[300px]"></div> </div > `; renderInvoiceScanner('scanner-container', (data) => { loadData.hasTicket = true; loadData.ticketText = data.rawText; loadData.ticketImage = data.file; loadData.material = "Dump Fee/Receipt"; loadData.isClean = true; loadData.notOverloaded = true; area.innerHTML = ''; area.style.pointerEvents = 'none'; onComplete(loadData); }); }; const renderStep1_Ticket = () => { area.innerHTML = ` <div class="bg-white rounded-2xl shadow-xl w-full max-w-md overflow-hidden animate-[fadeIn_0.2s_ease-out]" > <div class="bg-indigo-600 p-4 text-white flex justify-between items-center"> <h3 class="font-bold text-lg">Log Load - Step 2/5</h3> <button id="wiz-close" class="text-white hover:text-gray-200"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button> </div> <div class="p-6 text-center space-y-6"> <p class="text-xl font-bold text-gray-800">Do you have a Scale Ticket?</p> <div class="grid grid-cols-2 gap-4"> <button id="btn-ticket-yes" class="py-6 rounded-xl border-2 border-indigo-100 hover:bg-indigo-50 flex flex-col items-center justify-center gap-2 group transition-all"> <span class="text-3xl group-hover:scale-110 transition-transform">üìÑ</span> <span class="font-bold text-indigo-700">Yes, Scan It</span> </button> <button id="btn-ticket-no" class="py-6 rounded-xl border-2 border-gray-100 hover:bg-gray-50 flex flex-col items-center justify-center gap-2 group transition-all"> <span class="text-3xl group-hover:scale-110 transition-transform">‚úçÔ∏è</span> <span class="font-bold text-gray-700">No, Manual Entry</span> </button> </div> </div> </div > `; document.getElementById('wiz-close').onclick = () => { area.innerHTML = ''; area.style.pointerEvents = 'none'; }; document.getElementById('btn-ticket-yes').onclick = renderStep2_Scan; document.getElementById('btn-ticket-no').onclick = renderStep2_Manual; }; const renderStep2_Scan = () => { area.innerHTML = ` <div class="bg-white rounded-2xl shadow-xl w-full max-w-md overflow-hidden animate-[fadeIn_0.2s_ease-out]" > <div class="bg-indigo-600 p-4 text-white"><h3 class="font-bold text-lg">Scan Ticket - Step 2/4</h3></div> <div id="scanner-container" class="p-4 min-h-[300px]"></div> </div > `; renderInvoiceScanner('scanner-container', (data) => { loadData.hasTicket = true; loadData.ticketText = data.rawText; loadData.ticketImage = data.file; loadData.material = "Ticket Scanned"; renderStep3_Safety(); }); }; const renderStep2_Manual = () => { area.innerHTML = ` <div class="bg-white rounded-2xl shadow-xl w-full max-w-md overflow-hidden animate-[fadeIn_0.2s_ease-out]" > <div class="bg-indigo-600 p-4 text-white"><h3 class="font-bold text-lg">Load Details - Step 2/4</h3></div> <div class="p-6 space-y-4"> <label class="block font-bold text-gray-700">Material Type</label> <div class="grid grid-cols-2 gap-3"> ${['Mud/Dirt', 'Concrete Waste', 'Asphalt Waste', 'Snow', 'Gravel', 'Sand'].map(m => ` <button class="mat-btn p-3 border rounded-lg text-sm font-semibold hover:bg-indigo-50 text-left" data-val="${m}">${m}</button> `).join('')} </div> <input type="text" id="manual-mat-input" class="w-full p-3 border rounded-lg hidden" placeholder="Enter Material..."> </div> </div > `; area.querySelectorAll('.mat-btn').forEach(btn => { btn.addEventListener('click', (e) => { loadData.hasTicket = false; loadData.material = e.target.getAttribute('data-val'); renderStep3_Safety(); }); }); }; const renderStep3_Safety = () => { area.innerHTML = ` <div class="bg-white rounded-2xl shadow-xl w-full max-w-md overflow-hidden animate-[fadeIn_0.2s_ease-out]" > <div class="bg-red-600 p-4 text-white"><h3 class="font-bold text-lg">Safety Check - Step 3/4</h3></div> <div class="p-6 space-y-6"> <div class="space-y-4"> <label class="flex items-center gap-4 p-4 border rounded-xl bg-red-50 cursor-pointer"> <input type="checkbox" id="chk-debris" class="w-6 h-6 text-red-600 rounded"> <span class="font-bold text-gray-800">Loose Debris Removed / Tarped</span> </label> <label class="flex items-center gap-4 p-4 border rounded-xl bg-red-50 cursor-pointer"> <input type="checkbox" id="chk-overload" class="w-6 h-6 text-red-600 rounded"> <span class="font-bold text-gray-800">Truck is NOT Overloaded</span> </label> </div> <div> <label class="block font-bold text-gray-700 mb-2">Safety Concerns / Hazards</label> <textarea id="safety-notes" class="w-full p-3 border rounded-lg text-sm" rows="2" placeholder="e.g. Uneven ground, Low wires, Traffic..."></textarea> </div> <button id="btn-safety-next" class="w-full py-4 bg-gray-300 text-gray-500 font-bold rounded-xl cursor-not-allowed" disabled> Confirm & Continue </button> </div> </div > `; const check = () => { const c1 = document.getElementById('chk-debris').checked; const c2 = document.getElementById('chk-overload').checked; const btn = document.getElementById('btn-safety-next'); if (c1 && c2) { btn.disabled = false; btn.classList.remove('bg-gray-300', 'text-gray-500', 'cursor-not-allowed'); btn.classList.add('bg-red-600', 'text-white', 'hover:bg-red-700'); } else { btn.disabled = true; btn.classList.add('bg-gray-300', 'text-gray-500', 'cursor-not-allowed'); btn.classList.remove('bg-red-600', 'text-white', 'hover:bg-red-700'); } }; document.getElementById('chk-debris').onchange = check; document.getElementById('chk-overload').onchange = check; document.getElementById('btn-safety-next').onclick = () => { loadData.isClean = true; loadData.notOverloaded = true; loadData.safetyConcerns = document.getElementById('safety-notes').value; renderStep4_Damage(); }; }; const renderStep4_Damage = () => { area.innerHTML = ` < div class="bg-white rounded-2xl shadow-xl w-full max-w-md overflow-hidden animate-[fadeIn_0.2s_ease-out]" > <div class="bg-indigo-600 p-4 text-white"><h3 class="font-bold text-lg">Final Check - Step 4/4</h3></div> <div class="p-6 text-center space-y-6"> <p class="text-xl font-bold text-gray-800">Was there any damage during loading?</p> <div class="grid grid-cols-2 gap-4"> <button id="btn-dmg-no" class="py-6 rounded-xl border-2 border-green-100 bg-green-50 hover:bg-green-100 flex flex-col items-center justify-center gap-2"> <span class="text-3xl">‚úÖ</span> <span class="font-bold text-green-800">No Damage</span> </button> <button id="btn-dmg-yes" class="py-6 rounded-xl border-2 border-red-100 bg-red-50 hover:bg-red-100 flex flex-col items-center justify-center gap-2"> <span class="text-3xl">‚ö†Ô∏è</span> <span class="font-bold text-red-800">Yes, Report it</span> </button> </div> </div> </div > `; document.getElementById('btn-dmg-no').onclick = () => { area.innerHTML = ''; area.style.pointerEvents = 'none'; onComplete(loadData); }; document.getElementById('btn-dmg-yes').onclick = renderStep4B_DamageForm; }; const renderStep4B_DamageForm = () => { area.innerHTML = ` < div class="bg-white rounded-2xl shadow-xl w-full max-w-md overflow-hidden animate-[fadeIn_0.2s_ease-out]" > <div class="bg-red-600 p-4 text-white"><h3 class="font-bold text-lg">Report Damage</h3></div> <div class="p-6 space-y-4"> <div> <label class="block font-bold text-gray-700 mb-1">Description</label> <textarea id="dmg-desc" class="w-full p-3 border rounded-lg" rows="3" placeholder="Describe damage..."></textarea> </div> <div> <label class="block font-bold text-gray-700 mb-1">Operator Name</label> <input type="text" id="dmg-op-name" class="w-full p-3 border rounded-lg" placeholder="Name of Loader Operator"> </div> <div class="border-2 border-dashed border-gray-300 rounded-xl p-6 text-center text-gray-500"> [Photo Upload Placeholder] </div> <label class="flex items-center gap-3 p-3 bg-gray-50 rounded cursor-pointer"> <input type="checkbox" id="dmg-sig" class="w-5 h-5"> <span class="text-sm font-bold">Operator Signature / Acknowledge</span> </label> <button id="btn-dmg-submit" class="w-full py-4 bg-red-600 text-white font-bold rounded-xl hover:bg-red-700"> Submit Report </button> </div> </div > `; document.getElementById('btn-dmg-submit').onclick = () => { loadData.hasDamage = true; loadData.damageDescription = document.getElementById('dmg-desc').value; loadData.operatorName = document.getElementById('dmg-op-name').value; loadData.operatorSignature = document.getElementById('dmg-sig').checked; area.innerHTML = ''; area.style.pointerEvents = 'none'; onComplete(loadData); }; }; renderStep0_Type(); } }