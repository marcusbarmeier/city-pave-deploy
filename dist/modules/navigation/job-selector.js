// ¬© 2025 City Pave. All Rights Reserved. Unauthorized copying is prohibited.
export class JobSelector { constructor(containerId, options = {}) { this.containerId = containerId; this.onJobSelected = options.onJobSelected || (() => { }); this.onCancel = options.onCancel || (() => { }); this.mockDispatches = [ { id: 'job-101', client: 'City Pave HQ', type: 'Load', material: 'Asphalt', location: { lat: 34.0522, lng: -118.2437 }, address: '123 Main St, Cityville', workOrderDetails: 'Resurface main parking lot. Approx 400 tons. Note: Tight entrance, use north gate.', contacts: [ { name: 'Mike (Foreman)', role: 'Foreman', phone: '555-0101' }, { name: 'Sarah (Dispatcher)', role: 'Dispatch', phone: '555-0102' } ], stats: { loadCount: 4, volume: '80 tons' } }, { id: 'job-102', client: 'Green Valley Utils', type: 'Dump', material: 'Dirt', location: { lat: 34.0622, lng: -118.2537 }, address: '456 Valley Rd, Green Valley', workOrderDetails: 'Excavation spoil removal from utility trenching. Dump at designated fill area B.', contacts: [ { name: 'John (Site Super)', role: 'Superintendent', phone: '555-0201' } ], stats: { loadCount: 12, volume: '140 yds' } }, { id: 'job-103', client: 'Lakeside Construction', type: 'Load', material: 'Gravel', location: { lat: 34.0722, lng: -118.2637 }, address: '789 Lake Dr, Springfield', workOrderDetails: 'Base course for new subdivision. Keep speed down in residential areas.', contacts: [ { name: 'Bill (Lead)', role: 'Foreman', phone: '555-0301' } ], stats: { loadCount: 0, volume: '0 tons' } } ]; this.customMissions = [ { id: 'mission-fuel', label: 'Refuel', icon: '‚õΩ', type: 'maintenance' }, { id: 'mission-parts', label: 'Parts Run', icon: '‚öôÔ∏è', type: 'logistics' }, { id: 'mission-tools', label: 'Tools Run', icon: 'üõ†Ô∏è', type: 'logistics' }, { id: 'mission-shop', label: 'Return to Shop', icon: 'üè†', type: 'return' }, { id: 'mission-other', label: 'Other', icon: '‚ùì', type: 'misc' } ]; } render() { const container = document.getElementById(this.containerId); if (!container) return; const modal = document.createElement('div'); modal.className = 'absolute inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm pointer-events-auto'; modal.id = 'job-selector-modal'; modal.innerHTML = ` <div class="bg-gray-900 w-full max-w-4xl h-[80vh] rounded-2xl border border-blue-500/50 shadow-2xl flex flex-col overflow-hidden"> <!-- Header --> <div class="p-6 border-b border-gray-700 flex justify-between items-center bg-gray-800"> <h2 class="text-3xl font-bold text-white tracking-wide">MISSION CONTROL</h2> <button id="btn-close-selector" class="text-gray-400 hover:text-white transition-colors"> <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg> </button> </div> <!-- Content Grid --> <div class="flex-1 grid grid-cols-2 divide-x divide-gray-700"> <!-- Left: Active Dispatches --> <div class="p-6 overflow-auto"> <h3 class="text-xl font-semibold text-blue-400 mb-4 flex items-center"> <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg> Available Dispatches </h3> <div class="space-y-4"> ${this.mockDispatches.map(job => ` <div class="bg-gray-800 p-4 rounded-xl border border-gray-600 hover:border-blue-500 hover:bg-gray-750 transition-all cursor-pointer group" onclick="document.dispatchEvent(new CustomEvent('select-job', { detail: '${job.id}' }))"> <div class="flex justify-between items-start mb-2"> <span class="text-lg font-bold text-white">${job.client}</span> <span class="px-2 py-1 bg-blue-900/50 text-blue-300 text-xs rounded uppercase font-bold tracking-wider border border-blue-500/30">${job.type}</span> </div> <div class="text-gray-400 text-sm mb-1">${job.address}</div> <div class="flex items-center text-gray-500 text-xs mt-2"> <span class="mr-4">üì¶ ${job.material}</span> <span>üìç 2.4 mi away</span> </div> </div> `).join('')} </div> </div> <!-- Right: Custom Missions --> <div class="p-6 bg-gray-800/50"> <h3 class="text-xl font-semibold text-purple-400 mb-4 flex items-center"> <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg> Custom Mission </h3> <div class="grid grid-cols-2 gap-4"> ${this.customMissions.map(m => ` <button class="bg-gray-700 p-4 rounded-xl flex flex-col items-center justify-center hover:bg-gray-600 hover:scale-105 transition-all aspect-square border border-gray-600" onclick="document.dispatchEvent(new CustomEvent('select-mission', { detail: '${m.id}' }))"> <span class="text-4xl mb-2">${m.icon}</span> <span class="text-white font-medium">${m.label}</span> </button> `).join('')} </div> </div> </div> </div> `; container.appendChild(modal); modal.addEventListener('click', (e) => { }); document.getElementById('btn-close-selector').onclick = () => { modal.remove(); this.onCancel(); }; this.handleSelectJob = (e) => { const jobId = e.detail; const job = this.mockDispatches.find(j => j.id === jobId); if (job) { this.onJobSelected({ type: 'dispatch', data: job }); modal.remove(); } }; this.handleSelectMission = (e) => { const missionId = e.detail; if (missionId === 'mission-other') { this.renderCustomMissionForm(modal); return; } const mission = this.customMissions.find(m => m.id === missionId); if (mission) { this.onJobSelected({ type: 'mission', data: mission }); modal.remove(); } }; document.addEventListener('select-job', this.handleSelectJob); document.addEventListener('select-mission', this.handleSelectMission); const cleanup = () => { document.removeEventListener('select-job', this.handleSelectJob); document.removeEventListener('select-mission', this.handleSelectMission); }; const originalRemove = modal.remove.bind(modal); modal.remove = () => { cleanup(); originalRemove(); }; } renderCustomMissionForm(parentModal) { const contentContainer = parentModal.querySelector('.grid'); if (!contentContainer) return; const modalBody = parentModal.querySelector('.flex-1'); modalBody.innerHTML = ` <div class="p-8 h-full flex flex-col items-center justify-center space-y-6 bg-gray-800 animate-slide-up"> <h3 class="text-2xl font-bold text-white mb-2">Custom Mission Details</h3> <div class="w-full max-w-md space-y-4"> <div> <label class="block text-gray-400 text-sm font-bold mb-2">Description / Task Name</label> <input type="text" id="custom-desc" class="w-full bg-gray-700 text-white rounded-lg p-3 border border-gray-600 focus:border-blue-500 outline-none" placeholder="e.g. Helping Mechanic, Yard Maintenance"> </div> <div> <label class="block text-gray-400 text-sm font-bold mb-2">Association (Optional)</label> <select id="custom-assoc-select" class="w-full bg-gray-700 text-white rounded-lg p-3 border border-gray-600 focus:border-blue-500 outline-none mb-2"> <option value="">-- Select Active Job --</option> ${this.mockDispatches.map(j => `<option value="${j.client}">${j.client} (${j.address})</option>`).join('')} <option value="custom">Other / Custom Association</option> </select> <input type="text" id="custom-assoc-input" class="w-full bg-gray-700 text-white rounded-lg p-3 border border-gray-600 focus:border-blue-500 outline-none hidden" placeholder="Enter Custom Association"> </div> </div> <div class="flex space-x-4 w-full max-w-md mt-4"> <button id="btn-cancel-custom" class="flex-1 py-3 bg-gray-600 hover:bg-gray-500 text-white rounded-xl font-bold transition-colors">Cancel</button> <button id="btn-confirm-custom" class="flex-1 py-3 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 text-white rounded-xl font-bold transition-transform active:scale-95 shadow-lg">Start Custom Mission</button> </div> </div> `; const select = parentModal.querySelector('#custom-assoc-select'); const input = parentModal.querySelector('#custom-assoc-input'); select.onchange = () => { if (select.value === 'custom') { input.classList.remove('hidden'); input.focus(); } else { input.classList.add('hidden'); } }; parentModal.querySelector('#btn-cancel-custom').onclick = () => { parentModal.remove(); this.onCancel(); }; parentModal.querySelector('#btn-confirm-custom').onclick = () => { const desc = parentModal.querySelector('#custom-desc').value; const assocVal = select.value === 'custom' ? input.value : select.value; if (!desc) { alert("Please enter a description."); return; } const customMissionData = { id: 'mission-custom-' + Date.now(), label: desc, association: assocVal || 'None', icon: 'üìù', type: 'custom' }; this.onJobSelected({ type: 'mission', data: customMissionData }); parentModal.remove(); }; } }