// Â© 2025 City Pave. All Rights Reserved. Unauthorized copying is prohibited.
import { GeofenceService } from './GeofenceService.js'; export const Context = { state: { lastLocation: null, currentLocation: window.location.pathname, startTime: Date.now(), interactions: [] }, init: () => { Context.updateLocation(); window.addEventListener('popstate', Context.updateLocation); document.addEventListener('click', (e) => { if (e.target.tagName === 'BUTTON' || e.target.tagName === 'A') { Context.logInteraction(`Clicked ${e.target.innerText || e.target.tagName}`); } }); GeofenceService.init([ { id: 'site_A', name: 'Downtown Plaza Paving', lat: 40.7128, lng: -74.0060, radius: 0.5 }, { id: 'site_B', name: 'Westside Highway Repair', lat: 40.7589, lng: -73.9851, radius: 0.8 } ]); console.log("[AI Context] Initialized."); }, updateLocation: () => { Context.state.lastLocation = Context.state.currentLocation; Context.state.currentLocation = window.location.pathname; console.log(`[AI Context] Location changed: ${Context.state.currentLocation}`); }, logInteraction: (action) => { Context.state.interactions.push({ action, timestamp: Date.now() }); if (Context.state.interactions.length > 10) { Context.state.interactions.shift(); } }, getSnapshot: () => { let role = 'guest'; let email = 'unknown'; if (window.currentUser) { role = window.currentUser.role || 'guest'; email = window.currentUser.email || 'unknown'; } else if (window.firebaseServices && window.firebaseServices.auth && window.firebaseServices.auth.currentUser) { email = window.firebaseServices.auth.currentUser.email; role = 'authenticated'; } const pathParts = window.location.pathname.split('/'); const moduleIndex = pathParts.indexOf('modules'); const currentModule = (moduleIndex !== -1 && pathParts[moduleIndex + 1]) ? pathParts[moduleIndex + 1] : 'Dashboard'; return { userRole: role, userEmail: email, currentModule: currentModule, page: pathParts.pop() || 'index.html', recentActivity: Context.state.interactions.slice(-3) }; } };