// Â© 2025 City Pave. All Rights Reserved. Unauthorized copying is prohibited.
export const UI = { elements: { trigger: null, window: null, messages: null, input: null, sendBtn: null, chips: null }, init: (toggleCallback, sendCallback) => { UI.injectStyles(); UI.createDOM(); UI.attachListeners(toggleCallback, sendCallback); }, injectStyles: () => { if (!document.getElementById('ai-overlay-css')) { const link = document.createElement('link'); link.id = 'ai-overlay-css'; link.rel = 'stylesheet'; link.href = '/modules/ai-overlay/style.css'; document.head.appendChild(link); } }, createDOM: () => { const win = document.createElement('div'); win.id = 'ai-overlay-window'; win.innerHTML = ` <div class="ai-header"> <h3> <span class="ai-header-icon">âœ¨</span> City Pave Intelligence </h3> <button class="ai-close-btn">&times;</button> </div> <div class="ai-messages" id="ai-messages"> <div class="ai-msg ai">Hello! I'm your assistant. How can I help?</div> </div> <!-- Quick Replies --> <div class="ai-quick-replies" id="ai-quick-replies"> <!-- Chips injected here --> </div> <div class="ai-input-area"> <button class="ai-voice-btn" title="Voice Input (Coming Soon)">ðŸŽ¤</button> <input type="text" id="ai-input" placeholder="Ask anything..."> <button class="ai-send-btn" id="ai-send-btn">âž¤</button> </div> `; document.body.appendChild(win); UI.elements.window = win; UI.elements.messages = win.querySelector('#ai-messages'); UI.elements.input = win.querySelector('#ai-input'); UI.elements.sendBtn = win.querySelector('#ai-send-btn'); UI.elements.chips = win.querySelector('#ai-quick-replies'); UI.renderQuickReplies(['Show Status', 'Safety Protocol', 'Active Estimates'], (text) => { UI.elements.input.value = text; UI.elements.sendBtn.click(); }); }, showToast: (text, icon = 'â„¹ï¸') => { let toast = document.getElementById('ai-toast'); if (!toast) { toast = document.createElement('div'); toast.id = 'ai-toast'; toast.className = 'ai-toast'; document.body.appendChild(toast); } toast.innerHTML = `<span>${icon}</span><span>${text}</span>`; toast.classList.add('visible'); if (UI.toastTimer) clearTimeout(UI.toastTimer); UI.toastTimer = setTimeout(() => { toast.classList.remove('visible'); }, 3000); }, attachListeners: (toggleCallback, sendCallback) => { UI.elements.window.querySelector('.ai-close-btn').addEventListener('click', toggleCallback); const voiceBtn = UI.elements.window.querySelector('.ai-voice-btn'); let recognition = null; if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) { const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition; recognition = new SpeechRecognition(); recognition.continuous = false; recognition.interimResults = false; recognition.onstart = () => { voiceBtn.classList.add('listening'); UI.elements.input.placeholder = "Listening..."; }; recognition.onend = () => { voiceBtn.classList.remove('listening'); UI.elements.input.placeholder = "Ask anything..."; }; recognition.onresult = (event) => { const transcript = event.results[0][0].transcript; UI.elements.input.value = transcript; }; recognition.onerror = (event) => { console.warn("Speech Error", event.error); voiceBtn.classList.remove('listening'); UI.showToast("Microphone access blocked or error.", 'ðŸš«'); }; } voiceBtn.addEventListener('click', () => { if (!recognition) { UI.showToast("Voice input not supported in this browser.", 'âš ï¸'); return; } if (voiceBtn.classList.contains('listening')) { recognition.stop(); } else { recognition.start(); } }); const handleSend = () => { const text = UI.elements.input.value.trim(); if (text) { UI.addMessage(text, 'user'); UI.elements.input.value = ''; sendCallback(text); } }; UI.elements.sendBtn.addEventListener('click', handleSend); UI.elements.input.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleSend(); }); }, renderQuickReplies: (labels, onClick) => { if (!UI.elements.chips) return; UI.elements.chips.innerHTML = ''; labels.forEach(label => { const chip = document.createElement('button'); chip.className = 'ai-chip'; chip.textContent = label; chip.onclick = () => onClick(label); UI.elements.chips.appendChild(chip); }); }, reset: () => { if (UI.elements.messages) { UI.elements.messages.innerHTML = '<div class="ai-msg ai">Hello! I\'m your City Pave assistant. How can I help you today?</div>'; } }, toggleWindow: (isVisible) => { if (isVisible) { UI.elements.window.classList.add('visible'); setTimeout(() => UI.elements.input.focus(), 300); } else { UI.elements.window.classList.remove('visible'); } }, addContextTip: (text) => { const tip = document.createElement('div'); tip.className = 'ai-context-tip'; tip.textContent = text; UI.elements.messages.appendChild(tip); UI.scrollToBottom(); }, addMessage: (text, sender) => { const msg = document.createElement('div'); msg.className = `ai-msg ${sender}`; msg.textContent = text; UI.elements.messages.appendChild(msg); UI.scrollToBottom(); }, scrollToBottom: () => { UI.elements.messages.scrollTop = UI.elements.messages.scrollHeight; } };